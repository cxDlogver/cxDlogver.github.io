

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/dog.png">
  <link rel="icon" href="/img/dog.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Xiang Chen">
  <meta name="keywords" content="">
  
    <meta name="description" content="OpenLayers地图绘制 国内常用地图瓦片源地址汇总 - 知乎 天地图API  1.从0到1绘制一个地图【第 1 步：画出一个“地图容器”】在页面放一个 div，让 OpenLayers  把地图渲染到这个 div 里。 所有 Web 地图的本质就是：把画布挂到 DOM 容器上 12345678910&lt;template&gt;  &lt;div class&#x3D;&quot;map-con">
<meta property="og:type" content="article">
<meta property="og:title" content="15.OpenLayers地图绘制">
<meta property="og:url" content="http://example.com/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/index.html">
<meta property="og:site_name" content="相">
<meta property="og:description" content="OpenLayers地图绘制 国内常用地图瓦片源地址汇总 - 知乎 天地图API  1.从0到1绘制一个地图【第 1 步：画出一个“地图容器”】在页面放一个 div，让 OpenLayers  把地图渲染到这个 div 里。 所有 Web 地图的本质就是：把画布挂到 DOM 容器上 12345678910&lt;template&gt;  &lt;div class&#x3D;&quot;map-con">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/image-20260106231408318.png">
<meta property="og:image" content="http://example.com/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/image-20260107011810940.png">
<meta property="article:published_time" content="2026-01-06T14:54:25.000Z">
<meta property="article:modified_time" content="2026-01-08T13:30:16.347Z">
<meta property="article:author" content="Xiang Chen">
<meta property="article:tag" content="前端面试题">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/image-20260106231408318.png">
  
  
  
  <title>15.OpenLayers地图绘制 - 相</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>相</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="15.OpenLayers地图绘制"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-01-06 22:54" pubdate>
          2026年1月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          41 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">15.OpenLayers地图绘制</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>

<h2 id="OpenLayers地图绘制"><a href="#OpenLayers地图绘制" class="headerlink" title="OpenLayers地图绘制"></a><code>OpenLayers</code>地图绘制</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/641436984">国内常用地图瓦片源地址汇总 - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="http://lbs.tianditu.gov.cn/server/MapService.html">天地图API</a></p>
</blockquote>
<h3 id="1-从0到1绘制一个地图"><a href="#1-从0到1绘制一个地图" class="headerlink" title="1.从0到1绘制一个地图"></a>1.从0到1绘制一个地图</h3><h4 id="【第-1-步：画出一个“地图容器”】"><a href="#【第-1-步：画出一个“地图容器”】" class="headerlink" title="【第 1 步：画出一个“地图容器”】"></a>【第 1 步：画出一个“地图容器”】</h4><p>在页面放一个 div，让 <code>OpenLayers </code> 把地图渲染到这个 div 里。</p>
<p>所有 Web 地图的本质就是：<strong>把画布挂到 DOM 容器上</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;map-container&quot;&gt;<br>    &lt;div id=&quot;mapView&quot; class=&quot;mapView&quot;&gt;&lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.map-container &#123; width: 100%; height: 100%; &#125;<br>.mapView &#123; width: 100%; height: 100%; &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="【第-2-步：初始化-OpenLayers-Map】"><a href="#【第-2-步：初始化-OpenLayers-Map】" class="headerlink" title="【第 2 步：初始化 OpenLayers Map】"></a>【第 2 步：初始化 OpenLayers Map】</h4><p>创建 <code>new Map(&#123; target, layers, view &#125;)</code></p>
<ul>
<li><code>target</code>：渲染到哪个 DOM</li>
<li><code>layers</code>：地图显示什么</li>
<li><code>view</code>：中心点、投影、缩放等</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script lang=<span class="hljs-string">&quot;ts&quot;</span> setup&gt;<br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Map</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/Map&quot;</span>; <span class="hljs-comment">// 地图类</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">View</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/View&quot;</span>; <span class="hljs-comment">// 地图视图</span><br>  <span class="hljs-keyword">import</span> &#123; ref, onMounted, onBeforeUnmount &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>; <span class="hljs-comment">// vue 响应式 API</span><br><br>  <span class="hljs-keyword">const</span> map = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 地图实例</span><br>  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(&#123;<br>      <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;mapView&quot;</span>, <span class="hljs-comment">// 地图容器 DOM 元素 ID , 挂载到 mapView 元素上</span><br>      <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>(&#123; <span class="hljs-comment">// 地图视图配置</span><br>        <span class="hljs-attr">center</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">2</span>,<br>      &#125;),<br>    &#125;);<br>  &#125;);<br>  <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span>.<span class="hljs-title function_">setTarget</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 移除地图容器引用，防止内存泄漏</span><br>  &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>此时还是空白，因为没有图层。</p>
<h4 id="【第-3-步：添加“底图”】"><a href="#【第-3-步：添加“底图”】" class="headerlink" title="【第 3 步：添加“底图”】"></a>【第 3 步：添加“底图”】</h4><p>用 <code>XYZ</code> 作为瓦片数据源，用 <code>Tile</code> 作为瓦片图层。</p>
<p>底图是地图用户的“参照系”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br>&lt;script lang=<span class="hljs-string">&quot;ts&quot;</span> setup&gt;<br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Map</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/Map&quot;</span>; <span class="hljs-comment">// 地图类</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">View</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/View&quot;</span>; <span class="hljs-comment">// 地图视图</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Tile</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/layer/Tile&quot;</span>; <span class="hljs-comment">// 瓦片图层类</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">XYZ</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/source/XYZ&quot;</span>; <span class="hljs-comment">// XYZ 数据源类</span><br><br>  <span class="hljs-keyword">import</span> &#123; ref, onMounted, onBeforeUnmount &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>; <span class="hljs-comment">// vue 响应式 API</span><br><br>  <span class="hljs-keyword">const</span> map = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 地图实例</span><br><br>  <span class="hljs-comment">// 添加天地图图层</span><br>  <span class="hljs-keyword">const</span> tiandituMapSource = <span class="hljs-keyword">new</span> <span class="hljs-title function_">XYZ</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://t0.tianditu.com/DataServer?T=vec_w&amp;tk=d212aa1b10fc6b036280ee9eab8b389c&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;l=&#123;z&#125;&quot;</span>,<br>  &#125;);<br>  <span class="hljs-keyword">const</span> tiandiMapLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123;<br>    <span class="hljs-attr">zindex</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;矢量底图&quot;</span>,<br>    <span class="hljs-attr">source</span>: tiandituMapSource,<br>  &#125;);<br><br><br>  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(&#123;<br>      <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;mapView&quot;</span>, <span class="hljs-comment">// 地图容器 DOM 元素 ID , 挂载到 mapView 元素上</span><br>      <span class="hljs-attr">layers</span>: [tiandiMapLayer],<br>      <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>(&#123; <span class="hljs-comment">// 地图视图配置</span><br>        <span class="hljs-attr">center</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">2</span>,<br>      &#125;),<br>    &#125;);<br>  &#125;);<br>  <br>  <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span>.<span class="hljs-title function_">setTarget</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 移除地图容器引用，防止内存泄漏</span><br>  &#125;);<br><br>  <span class="hljs-comment">// map.value.addLayer(tiandiMapLayer);</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<img src="/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/image-20260106231408318.png" srcset="/img/loading.gif" lazyload class title="image-20260106231408318">

<h3 id="2-Layer图层"><a href="#2-Layer图层" class="headerlink" title="2.Layer图层"></a>2.<code>Layer</code>图层</h3><p>在 OpenLayers 中：</p>
<ul>
<li><strong>Layer（图层）</strong>：负责“怎么显示、显示顺序、是否可见、透明度”</li>
<li><strong>Source（数据源）</strong>：负责“数据从哪里来、怎么加载、加载策略”</li>
</ul>
<p>从架构上看，OpenLayers 的图层主要分为 <strong>三大类</strong>：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">Layer</span><br> ├── <span class="hljs-built_in">Raster</span>（栅格图层）<br> │     ├── <span class="hljs-variable">Tile</span><br> │     └── <span class="hljs-built_in">Image</span><br> ├── <span class="hljs-variable">Vector</span>（矢量图层）<br> └── <span class="hljs-variable">Specialized</span>（特殊用途图层）<br></code></pre></td></tr></table></figure>

<p>不同的图层，本质区别在于 <strong>“数据是图片还是矢量、是否切片、渲染发生在前端还是后端”</strong>。</p>
<h4 id="【Tile-图层】"><a href="#【Tile-图层】" class="headerlink" title="【Tile 图层】"></a>【Tile 图层】</h4><p>Tile 图层将地图按固定规则切分成大量 <strong>小图片（瓦片）</strong>，浏览器只加载当前视野内需要的瓦片。</p>
<h5 id="核心特点"><a href="#核心特点" class="headerlink" title="核心特点"></a>核心特点</h5><ul>
<li>图片是 <strong>提前切好的</strong></li>
<li>每张瓦片大小固定（通常 256×256）</li>
<li>支持多级缩放</li>
<li>浏览器只请求必要瓦片</li>
<li>性能非常稳定</li>
</ul>
<h5 id="解决什么问题"><a href="#解决什么问题" class="headerlink" title="解决什么问题"></a>解决什么问题</h5><ul>
<li>快速显示大范围地图</li>
<li>支撑高并发访问</li>
<li>保证缩放、拖拽流畅</li>
</ul>
<h5 id="不能解决什么"><a href="#不能解决什么" class="headerlink" title="不能解决什么"></a>不能解决什么</h5><ul>
<li>不能对单个地图要素做交互</li>
<li>样式不可动态修改（样式已经“画死”在瓦片里）</li>
</ul>
<h5 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h5><ul>
<li>底图（行政区划、道路、水系）</li>
<li>卫星影像</li>
<li>全国、省级地图展示</li>
<li>天地图、高德、OSM</li>
</ul>
<h5 id="工程举例"><a href="#工程举例" class="headerlink" title="工程举例"></a>工程举例</h5><ul>
<li>WebGIS 项目中：<ul>
<li>第一层：Tile 底图</li>
<li>上面再叠加业务图层</li>
</ul>
</li>
<li>城市管理系统中：<ul>
<li>永远存在一个不可编辑的基础底图</li>
</ul>
</li>
</ul>
<h4 id="【Image-图层】"><a href="#【Image-图层】" class="headerlink" title="【Image 图层】"></a>【Image 图层】</h4><p>Image 图层在 <strong>当前视图范围内只请求一整张图片</strong>，不进行瓦片拆分。</p>
<h5 id="核心特点-1"><a href="#核心特点-1" class="headerlink" title="核心特点"></a>核心特点</h5><ul>
<li>每次视图变化重新请求整张图</li>
<li>图片通常由服务器动态生成</li>
<li>渲染逻辑主要在后端</li>
</ul>
<h5 id="解决什么问题-1"><a href="#解决什么问题-1" class="headerlink" title="解决什么问题"></a>解决什么问题</h5><ul>
<li>后端动态制图</li>
<li>复杂符号、专题渲染</li>
<li>不方便切片的数据</li>
</ul>
<h5 id="不能解决什么-1"><a href="#不能解决什么-1" class="headerlink" title="不能解决什么"></a>不能解决什么</h5><ul>
<li>拖动和缩放时性能不如 Tile</li>
<li>频繁视图变化会频繁请求新图</li>
</ul>
<h5 id="典型应用场景-1"><a href="#典型应用场景-1" class="headerlink" title="典型应用场景"></a>典型应用场景</h5><ul>
<li>WMS 服务</li>
<li>专题分析图</li>
<li>统计热区、等值线、分析结果</li>
</ul>
<h5 id="工程举例-1"><a href="#工程举例-1" class="headerlink" title="工程举例"></a>工程举例</h5><ul>
<li>管网压力分布图</li>
<li>泄漏概率专题图</li>
<li>实时计算的风险热区图</li>
</ul>
<h4 id="【Vector-图层】"><a href="#【Vector-图层】" class="headerlink" title="【Vector 图层】"></a>【Vector 图层】</h4><p>Vector 图层将 <strong>点、线、面要素直接加载到浏览器内存中</strong>，由前端负责渲染和交互。</p>
<h5 id="核心特点-2"><a href="#核心特点-2" class="headerlink" title="核心特点"></a>核心特点</h5><ul>
<li>每一个要素是独立对象</li>
<li>支持样式函数</li>
<li>支持事件监听</li>
<li>可编辑、可选中</li>
</ul>
<h5 id="解决什么问题-2"><a href="#解决什么问题-2" class="headerlink" title="解决什么问题"></a>解决什么问题</h5><ul>
<li>业务对象展示</li>
<li>用户交互</li>
<li>编辑与绘制</li>
</ul>
<h5 id="不能解决什么-2"><a href="#不能解决什么-2" class="headerlink" title="不能解决什么"></a>不能解决什么</h5><ul>
<li>不适合超大规模数据</li>
<li>几十万要素会明显卡顿</li>
</ul>
<h5 id="典型应用场景-2"><a href="#典型应用场景-2" class="headerlink" title="典型应用场景"></a>典型应用场景</h5><ul>
<li>实时点位</li>
<li>管线、区域标注</li>
<li>用户绘制、编辑功能</li>
</ul>
<h5 id="工程举例-2"><a href="#工程举例-2" class="headerlink" title="工程举例"></a>工程举例</h5><ul>
<li>地图上点击某个监测点弹出信息</li>
<li>管网中某条管道高亮</li>
<li>WebSocket 推送实时设备位置</li>
</ul>
<h4 id="【VectorImage-图层】"><a href="#【VectorImage-图层】" class="headerlink" title="【VectorImage 图层】"></a>【VectorImage 图层】</h4><p>数据仍然是矢量，但在渲染阶段 <strong>先转成图片再显示</strong>。</p>
<h5 id="核心特点-3"><a href="#核心特点-3" class="headerlink" title="核心特点"></a>核心特点</h5><ul>
<li>渲染性能优于 Vector</li>
<li>保留部分样式能力</li>
<li>交互能力弱于 Vector</li>
</ul>
<h5 id="解决什么问题-3"><a href="#解决什么问题-3" class="headerlink" title="解决什么问题"></a>解决什么问题</h5><ul>
<li>中等规模矢量性能问题</li>
<li>需要样式但不需要复杂交互</li>
</ul>
<h5 id="不能解决什么-3"><a href="#不能解决什么-3" class="headerlink" title="不能解决什么"></a>不能解决什么</h5><ul>
<li>不适合高频交互</li>
<li>要素级事件能力受限</li>
</ul>
<h5 id="典型应用场景-3"><a href="#典型应用场景-3" class="headerlink" title="典型应用场景"></a>典型应用场景</h5><ul>
<li>不需要点选的业务区域</li>
<li><strong>静态展示但样式复杂的图层</strong></li>
</ul>
<h5 id="工程举例-3"><a href="#工程举例-3" class="headerlink" title="工程举例"></a>工程举例</h5><ul>
<li>管网分区背景层</li>
<li>风险等级区域渲染层</li>
</ul>
<h4 id="【VectorTile-图层】"><a href="#【VectorTile-图层】" class="headerlink" title="【VectorTile 图层】"></a>【VectorTile 图层】</h4><p>将矢量数据 <strong>在服务端切成瓦片</strong>，前端按瓦片加载矢量要素。</p>
<h5 id="核心特点-4"><a href="#核心特点-4" class="headerlink" title="核心特点"></a>核心特点</h5><ul>
<li>结合 Tile 的性能优势</li>
<li>保留矢量样式能力</li>
<li>前端控制样式</li>
<li>支持超大规模数据</li>
</ul>
<h5 id="解决什么问题-4"><a href="#解决什么问题-4" class="headerlink" title="解决什么问题"></a>解决什么问题</h5><ul>
<li>全国级、城市级矢量数据展示</li>
<li>高性能 + 可定制样式</li>
</ul>
<h5 id="不能解决什么-4"><a href="#不能解决什么-4" class="headerlink" title="不能解决什么"></a>不能解决什么</h5><ul>
<li>服务端复杂度较高</li>
<li>数据更新成本较高</li>
</ul>
<h5 id="典型应用场景-4"><a href="#典型应用场景-4" class="headerlink" title="典型应用场景"></a>典型应用场景</h5><ul>
<li>城市道路、建筑物</li>
<li>大规模管网</li>
<li>行政区划动态渲染</li>
</ul>
<h5 id="工程举例-4"><a href="#工程举例-4" class="headerlink" title="工程举例"></a>工程举例</h5><ul>
<li>城市级管网全量展示</li>
<li>道路等级随缩放变化显示</li>
</ul>
<h3 id="3-天地图API"><a href="#3-天地图API" class="headerlink" title="3. 天地图API"></a>3. 天地图API</h3><p>天地图本质是一个 <strong>WMTS 服务集</strong>：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">天地图 WMTS<br> ├── 矢量地图（vec）<br> ├── 影像地图（img）<br> ├── 地形地图（ter）<br> ├── 注记图层（cva <span class="hljs-regexp">/ cia /</span> cta）<br></code></pre></td></tr></table></figure>

<p><strong>所有类型：</strong></p>
<ul>
<li>请求方式相同</li>
<li>瓦片规则相同</li>
<li>API 结构相同</li>
</ul>
<p><strong>区别只在一个参数：layer 名称</strong></p>
<table>
<thead>
<tr>
<th>注记类型</th>
<th>对应底图</th>
</tr>
</thead>
<tbody><tr>
<td>cva</td>
<td>矢量注记</td>
</tr>
<tr>
<td>cia</td>
<td>影像注记</td>
</tr>
<tr>
<td>cta</td>
<td>地形注记</td>
</tr>
</tbody></table>
<p>拆分原因非常工程化：</p>
<ol>
<li>注记是 <strong>语言相关的</strong></li>
<li>注记更新频率高</li>
<li>注记样式可能变化</li>
</ol>
<p>如果注记和底图绑死：</p>
<ul>
<li>缓存效率极低</li>
<li>多语言难以支持</li>
</ul>
<h3 id="4-加载不同底图"><a href="#4-加载不同底图" class="headerlink" title="4. 加载不同底图"></a>4. 加载不同底图</h3><p>可以在<code>Layer</code>添加不同的地图，通过<code>zIndex</code>设置层级。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script lang=<span class="hljs-string">&quot;ts&quot;</span> setup&gt;<br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Map</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/Map&quot;</span>; <span class="hljs-comment">// 地图类</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">View</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/View&quot;</span>; <span class="hljs-comment">// 地图视图</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Tile</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/layer/Tile&quot;</span>; <span class="hljs-comment">// 瓦片图层类</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">XYZ</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/source/XYZ&quot;</span>; <span class="hljs-comment">// XYZ 数据源类</span><br><br>  <span class="hljs-keyword">import</span> &#123; ref, onMounted, onBeforeUnmount &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>; <span class="hljs-comment">// vue 响应式 API</span><br><br>  <span class="hljs-keyword">const</span> map = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 地图实例</span><br><br>  <span class="hljs-comment">// 添加天地图图层</span><br>  <span class="hljs-keyword">const</span> tiandituMapSource = <span class="hljs-keyword">new</span> <span class="hljs-title function_">XYZ</span>(&#123;<br>    <span class="hljs-attr">url</span>: <br>      <span class="hljs-string">&quot;http://t0.tianditu.gov.cn/vec_w/wmts?&quot;</span> +<br>      <span class="hljs-string">&quot;SERVICE=WMTS&amp;REQUEST=GetTile&amp;VERSION=1.0.0&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;LAYER=vec&amp;STYLE=default&amp;TILEMATRIXSET=w&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;FORMAT=tiles&amp;TILEMATRIX=&#123;z&#125;&amp;TILEROW=&#123;y&#125;&amp;TILECOL=&#123;x&#125;&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;tk=d212aa1b10fc6b036280ee9eab8b389c&quot;</span>,<br>  &#125;);<br>  <span class="hljs-keyword">const</span> tiandiMapLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123;<br>    <span class="hljs-attr">zIndex</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">source</span>: tiandituMapSource,<br>  &#125;);<br><br>  <span class="hljs-comment">//全球境界</span><br>  <span class="hljs-keyword">const</span> tiandituBoundarySource = <span class="hljs-keyword">new</span> <span class="hljs-title function_">XYZ</span>(&#123;<br>    <span class="hljs-attr">url</span>:<br>      <span class="hljs-string">&quot;http://t0.tianditu.gov.cn/ibo_w/wmts?&quot;</span> +<br>      <span class="hljs-string">&quot;SERVICE=WMTS&amp;REQUEST=GetTile&amp;VERSION=1.0.0&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;LAYER=ibo&amp;STYLE=default&amp;TILEMATRIXSET=w&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;FORMAT=tiles&amp;TILEMATRIX=&#123;z&#125;&amp;TILEROW=&#123;y&#125;&amp;TILECOL=&#123;x&#125;&quot;</span> +<br>      <span class="hljs-string">&quot;&amp;tk=d212aa1b10fc6b036280ee9eab8b389c&quot;</span>,<br>  &#125;);<br>  <span class="hljs-keyword">const</span> tiandituBoundaryLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123;<br>    <span class="hljs-attr">zIndex</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-attr">source</span>: tiandituBoundarySource,<br>  &#125;);<br><br>  <span class="hljs-comment">//天地图矢量注记</span><br>  <span class="hljs-keyword">const</span> tiandituMessageSource = <span class="hljs-keyword">new</span> <span class="hljs-title function_">XYZ</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://t0.tianditu.com/DataServer?T=cia_w&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;l=&#123;z&#125;&amp;tk=d212aa1b10fc6b036280ee9eab8b389c&quot;</span>,<br>    <span class="hljs-attr">tilePixelRatio</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 固定设置为2以获得更高清晰度</span><br>    <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">&quot;anonymous&quot;</span>, <span class="hljs-comment">// 添加跨域支持</span><br>  &#125;);<br><br>  <span class="hljs-keyword">const</span> tiandituMessageLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123;<br>    <span class="hljs-attr">zIndex</span>: <span class="hljs-number">100</span>,<br>    <span class="hljs-attr">source</span>: tiandituMessageSource,<br>    <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">18</span>,<br>    <span class="hljs-attr">preload</span>: <span class="hljs-title class_">Infinity</span>, <span class="hljs-comment">// 预加载所有瓦片</span><br>  &#125;);<br><br>  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(&#123;<br>      <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;mapView&quot;</span>, <span class="hljs-comment">// 地图容器 DOM 元素 ID , 挂载到 mapView 元素上</span><br>      <span class="hljs-attr">layers</span>: [tiandiMapLayer, tiandituBoundaryLayer, tiandituMessageLayer],<br>      <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>(&#123; <span class="hljs-comment">// 地图视图配置</span><br>        <span class="hljs-attr">center</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">2</span>,<br>      &#125;),<br>    &#125;);<br>  &#125;);<br>  <br>  <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    map.<span class="hljs-property">value</span>.<span class="hljs-title function_">setTarget</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 移除地图容器引用，防止内存泄漏</span><br>  &#125;);<br><br>  <span class="hljs-comment">// map.value.addLayer(tiandiMapLayer);</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<img src="/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/15-%E4%BA%8C%E7%BB%B4%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6/image-20260107011810940.png" srcset="/img/loading.gif" lazyload class title="image-20260107011810940">

<h3 id="5-VectorLayer"><a href="#5-VectorLayer" class="headerlink" title="5. VectorLayer"></a>5. VectorLayer</h3><blockquote>
<p>VectorLayer 是 OpenLayers 中唯一支持要素级渲染、样式控制和交互的图层类型，适合承载所有“需要参与业务逻辑”的地图对象，而 TileLayer 只适合作为视觉底图。</p>
</blockquote>
<p><strong>VectorLayer &#x3D; 客户端可计算、可交互的矢量要素图层</strong></p>
<p>它与 TileLayer 的本质区别在于：</p>
<table>
<thead>
<tr>
<th>对比维度</th>
<th>VectorLayer</th>
<th>TileLayer</th>
</tr>
</thead>
<tbody><tr>
<td>数据形态</td>
<td>点 &#x2F; 线 &#x2F; 面（Feature）</td>
<td>已渲染图片</td>
</tr>
<tr>
<td>渲染位置</td>
<td>浏览器端</td>
<td>服务端</td>
</tr>
<tr>
<td>是否可交互</td>
<td>可以</td>
<td>不可以</td>
</tr>
<tr>
<td>样式控制</td>
<td>完全前端可控</td>
<td>不可控</td>
</tr>
<tr>
<td>常见用途</td>
<td>标注、选中、高亮、分析</td>
<td>底图、影像、行政区描边</td>
</tr>
</tbody></table>
<p>一句话总结：</p>
<blockquote>
<p><strong>只要你要与用户交互，就必须用 VectorLayer。</strong></p>
</blockquote>
<h4 id="【三层结构】"><a href="#【三层结构】" class="headerlink" title="【三层结构】"></a>【三层结构】</h4><p>一个 VectorLayer 至少由三层结构构成：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-built_in">Feature</span>（要素）<br>   ↓<br>VectorSource（数据容器）<br>   ↓<br>VectorLayer（渲染与交互载体）<br></code></pre></td></tr></table></figure>

<p>缺一不可。</p>
<p><strong>1. 引入核心模块</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">VectorLayer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/layer/Vector&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VectorSource</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/source/Vector&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Feature</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/Feature&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Point</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/geom/Point&quot;</span>;<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>2. 创建一个点 Feature</strong></p>
<p>注意：<strong>OpenLayers 默认坐标系是 EPSG:3857</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> pointFeature = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Feature</span>(&#123;<br>  <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]),<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;test-point&quot;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>3. 创建 VectorSource</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vectorSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorSource</span>(&#123;<br>  <span class="hljs-attr">features</span>: [pointFeature],<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>4. 创建 VectorLayer</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vectorLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorLayer</span>(&#123;<br>  <span class="hljs-attr">source</span>: vectorSource,<br>  <span class="hljs-attr">zIndex</span>: <span class="hljs-number">10</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>5. 加入地图</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">map.<span class="hljs-title function_">addLayer</span>(vectorLayer);<br></code></pre></td></tr></table></figure>

<p>到这一步，一个“什么样式都没设”的矢量点已经存在了。</p>
<h4 id="【VectorLayer-的样式机制】"><a href="#【VectorLayer-的样式机制】" class="headerlink" title="【VectorLayer 的样式机制】"></a>【VectorLayer 的样式机制】</h4><p>VectorLayer 不像 TileLayer 那样“自带样式”，因为：</p>
<ul>
<li>Feature 是几何数据</li>
<li>样式完全由前端决定</li>
<li>样式可以是函数（与属性、缩放级别有关）</li>
</ul>
<h4 id="最基本的-Style-写法"><a href="#最基本的-Style-写法" class="headerlink" title="最基本的 Style 写法"></a>最基本的 Style 写法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Style</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/style/Style&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">CircleStyle</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/style/Circle&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Fill</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/style/Fill&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Stroke</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ol/style/Stroke&quot;</span>;<br><br>pointFeature.<span class="hljs-title function_">setStyle</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Style</span>(&#123;<br>    <span class="hljs-attr">image</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircleStyle</span>(&#123;<br>      <span class="hljs-attr">radius</span>: <span class="hljs-number">6</span>,<br>      <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;red&quot;</span> &#125;),<br>      <span class="hljs-attr">stroke</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>(&#123;<br>        <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#fff&quot;</span>,<br>        <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,<br>      &#125;),<br>    &#125;),<br>  &#125;)<br>);<br></code></pre></td></tr></table></figure>

<h5 id="给整个图层统一样式（推荐工程做法）"><a href="#给整个图层统一样式（推荐工程做法）" class="headerlink" title="给整个图层统一样式（推荐工程做法）"></a>给整个图层统一样式（推荐工程做法）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vectorLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorLayer</span>(&#123;<br>  <span class="hljs-attr">source</span>: vectorSource,<br>  <span class="hljs-attr">style</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Style</span>(&#123;<br>    <span class="hljs-attr">image</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircleStyle</span>(&#123;<br>      <span class="hljs-attr">radius</span>: <span class="hljs-number">5</span>,<br>      <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#409eff&quot;</span> &#125;),<br>    &#125;),<br>  &#125;),<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="样式函数（进阶但常用）"><a href="#样式函数（进阶但常用）" class="headerlink" title="样式函数（进阶但常用）"></a>样式函数（进阶但常用）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vectorLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorLayer</span>(&#123;<br>  <span class="hljs-attr">source</span>: vectorSource,<br>  <span class="hljs-attr">style</span>: <span class="hljs-function">(<span class="hljs-params">feature, resolution</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> type = feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;type&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Style</span>(&#123;<br>      <span class="hljs-attr">image</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircleStyle</span>(&#123;<br>        <span class="hljs-attr">radius</span>: type === <span class="hljs-string">&quot;warning&quot;</span> ? <span class="hljs-number">8</span> : <span class="hljs-number">4</span>,<br>        <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123;<br>          <span class="hljs-attr">color</span>: type === <span class="hljs-string">&quot;warning&quot;</span> ? <span class="hljs-string">&quot;red&quot;</span> : <span class="hljs-string">&quot;blue&quot;</span>,<br>        &#125;),<br>      &#125;),<br>    &#125;);<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="【VectorLayer-的交互能力】"><a href="#【VectorLayer-的交互能力】" class="headerlink" title="【VectorLayer 的交互能力】"></a>【VectorLayer 的交互能力】</h4><h5 id="1-点击要素（最常用）"><a href="#1-点击要素（最常用）" class="headerlink" title="1. 点击要素（最常用）"></a>1. 点击要素（最常用）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">map.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;singleclick&quot;</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> &#123;<br>  map.<span class="hljs-title function_">forEachFeatureAtPixel</span>(evt.<span class="hljs-property">pixel</span>, <span class="hljs-function">(<span class="hljs-params">feature</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(feature.<span class="hljs-title function_">getProperties</span>());<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="2-高亮选中（典型模式）"><a href="#2-高亮选中（典型模式）" class="headerlink" title="2. 高亮选中（典型模式）"></a>2. 高亮选中（典型模式）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> selectedFeature = <span class="hljs-literal">null</span>;<br><br>map.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;singleclick&quot;</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (selectedFeature) &#123;<br>    selectedFeature.<span class="hljs-title function_">setStyle</span>(defaultStyle);<br>    selectedFeature = <span class="hljs-literal">null</span>;<br>  &#125;<br><br>  map.<span class="hljs-title function_">forEachFeatureAtPixel</span>(evt.<span class="hljs-property">pixel</span>, <span class="hljs-function">(<span class="hljs-params">feature</span>) =&gt;</span> &#123;<br>    selectedFeature = feature;<br>    feature.<span class="hljs-title function_">setStyle</span>(highlightStyle);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="【生命周期】"><a href="#【生命周期】" class="headerlink" title="【生命周期】"></a>【生命周期】</h4><h5 id="1-创建时机"><a href="#1-创建时机" class="headerlink" title="1. 创建时机"></a>1. 创建时机</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  map.<span class="hljs-title function_">addLayer</span>(vectorLayer);<br>&#125;);<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="2-销毁时机（防内存泄漏）"><a href="#2-销毁时机（防内存泄漏）" class="headerlink" title="2. 销毁时机（防内存泄漏）"></a>2. 销毁时机（防内存泄漏）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  vectorSource.<span class="hljs-title function_">clear</span>();<br>  map.<span class="hljs-title function_">removeLayer</span>(vectorLayer);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="6-自定义瓦片加载"><a href="#6-自定义瓦片加载" class="headerlink" title="6. 自定义瓦片加载"></a>6. 自定义瓦片加载</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//渲染地图（qgs服务的地图数据）,低分辨率</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createQgjZoomLayer1</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> customTileGrid = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TileGrid</span>(&#123;<br>    <span class="hljs-attr">tileSize</span>: <span class="hljs-number">1024</span>, <span class="hljs-comment">// 修改瓦片大小</span><br>    <span class="hljs-comment">// 以下参数需根据实际坐标系和服务端配置调整</span><br>    <span class="hljs-attr">origin</span>: [-<span class="hljs-number">180</span>, <span class="hljs-number">90</span>], <span class="hljs-comment">// 瓦片网格原点（示例为 EPSG:4326 常用值）</span><br>    <span class="hljs-attr">resolutions</span>: [<br>      <span class="hljs-comment">// 分辨率数组（需与服务端支持的缩放级别匹配）</span><br>      <span class="hljs-number">0.703125</span>, <span class="hljs-comment">// 缩放级别 0</span><br>      <span class="hljs-number">0.3515625</span>, <span class="hljs-comment">// 缩放级别 1</span><br>      <span class="hljs-number">0.17578125</span>, <span class="hljs-comment">// 缩放级别 2（根据实际情况扩展）</span><br>    ],<br>  &#125;);<br>  <span class="hljs-keyword">const</span> token = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;leiyangUser&quot;</span>))?.<span class="hljs-property">token</span>;<br><br>  <span class="hljs-keyword">const</span> qgjMapSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TileWMS</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;baseURL&#125;</span>/map/getmap`</span>,<br>    <span class="hljs-attr">params</span>: &#123;<br>      <span class="hljs-attr">SERVICE</span>: <span class="hljs-string">&quot;WMS&quot;</span>,<br>      <span class="hljs-attr">VERSION</span>: <span class="hljs-string">&quot;1.1.0&quot;</span>,<br>      <span class="hljs-attr">REQUEST</span>: <span class="hljs-string">&quot;GetMap&quot;</span>,<br>      <span class="hljs-title class_">Map</span>: props.<span class="hljs-property">qgsMapPath</span>,<br>      <span class="hljs-attr">LAYERS</span>: props.<span class="hljs-property">tifMapPath</span>,<br>      <span class="hljs-attr">FORMAT</span>: <span class="hljs-string">&quot;image/png&quot;</span>,<br>      <span class="hljs-attr">CRS</span>: <span class="hljs-string">&quot;EPSG:4326&quot;</span>,<br>      <span class="hljs-attr">language</span>: locale.<span class="hljs-property">value</span>,<br>    &#125;,<br>    <span class="hljs-attr">tileGrid</span>: customTileGrid,<br>    <span class="hljs-attr">serverType</span>: <span class="hljs-string">&quot;geoserver&quot;</span>,<br><br>    <span class="hljs-comment">// 自定义 tile 加载函数</span><br>    <span class="hljs-attr">tileLoadFunction</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">imageTile, src</span>) &#123;<br>      <span class="hljs-title function_">fetch</span>(src, &#123;<br>        <span class="hljs-attr">headers</span>: &#123;<br>          <span class="hljs-title class_">Token</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;token&#125;</span>`</span>,<br>        &#125;,<br>      &#125;)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Network response was not ok&quot;</span>);<br>          &#125;<br>          <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">blob</span>();<br>        &#125;)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> objectUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>          imageTile.<span class="hljs-title function_">getImage</span>().<span class="hljs-property">src</span> = objectUrl;<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Tile loading error:&quot;</span>, err);<br>        &#125;);<br>    &#125;,<br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123;<br>    <span class="hljs-attr">zIndex</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-attr">source</span>: qgjMapSource,<br>    <span class="hljs-attr">minZoom</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">12</span>,<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>

<h4 id="【创建阶段】"><a href="#【创建阶段】" class="headerlink" title="【创建阶段】"></a>【创建阶段】</h4><h5 id="1-创建-customTileGrid"><a href="#1-创建-customTileGrid" class="headerlink" title="1. 创建 customTileGrid"></a>1. 创建 <code>customTileGrid</code></h5><p>你定义了：</p>
<ul>
<li><code>origin</code>：瓦片网格的左上角起点（决定 x&#x2F;y 怎么编号）</li>
<li><code>tileSize</code>：每块瓦片图片的像素大小（例如 256&#x2F;512&#x2F;1024）</li>
<li><code>resolutions</code>：每个 zoom 级别“一个像素代表多少地理单位（度&#x2F;像素）”</li>
</ul>
<p>这三者决定了：</p>
<blockquote>
<p>在 zoom&#x3D;z 时，视图范围会被切成哪些瓦片（z&#x2F;x&#x2F;y），每块瓦片对应什么地理范围 BBOX。 <strong>通常使用自定义的即可</strong></p>
</blockquote>
<h5 id="2-创建-TileWMS"><a href="#2-创建-TileWMS" class="headerlink" title="2. 创建 TileWMS"></a>2. 创建 <code>TileWMS</code></h5><p>你传入：</p>
<ul>
<li><code>url: /map/getmap</code></li>
<li><code>params: &#123;...&#125;</code> WMS 请求参数（SERVICE&#x2F;REQUEST&#x2F;LAYERS&#x2F;FORMAT&#x2F;CRS…）</li>
<li><code>tileGrid: customTileGrid</code></li>
<li><code>tileLoadFunction: ...</code></li>
</ul>
<p>这一步只是把“规则”装配好，<strong>并没有发请求</strong>。</p>
<h5 id="3-创建-TileLayer"><a href="#3-创建-TileLayer" class="headerlink" title="3. 创建 TileLayer"></a>3. 创建 <code>TileLayer</code></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tile</span>(&#123; <span class="hljs-attr">source</span>: qgjMapSource &#125;)<br></code></pre></td></tr></table></figure>

<p>图层对象准备好，等被 <code>map.addLayer(layer)</code> 后，才会开始触发加载。</p>
<h4 id="【触发阶段】"><a href="#【触发阶段】" class="headerlink" title="【触发阶段】"></a>【触发阶段】</h4><p>当你执行（显式或隐式）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">map.<span class="hljs-title function_">addLayer</span>(tileLayer)<br></code></pre></td></tr></table></figure>

<p>地图开始渲染，进入一次 render frame。</p>
<p>地图渲染引擎会问这个图层：</p>
<blockquote>
<p>“以当前 View（center&#x2F;zoom&#x2F;resolution）和屏幕大小，我需要哪些瓦片才能铺满可视区域？”</p>
</blockquote>
<h4 id="【瓦片计算阶段】"><a href="#【瓦片计算阶段】" class="headerlink" title="【瓦片计算阶段】"></a>【瓦片计算阶段】</h4><h5 id="3-1-View-给出当前分辨率-resolution"><a href="#3-1-View-给出当前分辨率-resolution" class="headerlink" title="3.1 View 给出当前分辨率 resolution"></a>3.1 View 给出当前分辨率 resolution</h5><p>例如 zoom&#x3D;2 对应 <code>resolutions[2]</code></p>
<h5 id="3-2-用-TileGrid-切分屏幕覆盖的地理范围"><a href="#3-2-用-TileGrid-切分屏幕覆盖的地理范围" class="headerlink" title="3.2 用 TileGrid 切分屏幕覆盖的地理范围"></a>3.2 用 TileGrid 切分屏幕覆盖的地理范围</h5><p>TileGrid 依据：</p>
<ul>
<li><code>origin</code></li>
<li><code>tileSize</code></li>
<li><code>resolution</code><br> 计算出可视范围覆盖的瓦片坐标集合：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">(z, <span class="hljs-attribute">x</span>, <span class="hljs-attribute">y</span>) 的列表<br></code></pre></td></tr></table></figure>

<p>这一步决定了要加载的瓦片数量和编号。</p>
<h4 id="【URL-生成阶段】"><a href="#【URL-生成阶段】" class="headerlink" title="【URL 生成阶段】"></a>【URL 生成阶段】</h4><p>TileWMS 拼出每块瓦片的 GetMap 请求</p>
<p>对每一个 (z, x, y)，TileWMS 会算出该瓦片对应的 BBOX：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable constant_">BBOX</span> = [minLon, minLat, maxLon, maxLat]<br><span class="hljs-variable constant_">WIDTH</span> = tileSize<br><span class="hljs-variable constant_">HEIGHT</span> = tileSize<br></code></pre></td></tr></table></figure>

<p>然后生成完整 URL（逻辑形态类似）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">/map/getmap?<br>  <span class="hljs-variable constant_">SERVICE</span>=<span class="hljs-variable constant_">WMS</span><br>  <span class="hljs-variable constant_">REQUEST</span>=<span class="hljs-title class_">GetMap</span><br>  <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-number">1.1</span><span class="hljs-number">.0</span><br>  <span class="hljs-variable constant_">LAYERS</span>=...<br>  <span class="hljs-variable constant_">FORMAT</span>=image/png<br>  <span class="hljs-variable constant_">CRS</span>=<span class="hljs-attr">EPSG</span>:<span class="hljs-number">4326</span><br>  <span class="hljs-variable constant_">WIDTH</span>=<span class="hljs-number">1024</span><br>  <span class="hljs-variable constant_">HEIGHT</span>=<span class="hljs-number">1024</span><br>  <span class="hljs-variable constant_">BBOX</span>=minx,miny,maxx,maxy<br>  language=...<br>  <span class="hljs-title class_">Map</span>=...<br></code></pre></td></tr></table></figure>

<p>到这里为止：</p>
<ul>
<li>TileWMS 已经把每块瓦片的“请求地址”算出来了</li>
<li>但默认行为本应是：<code>img.src = url</code></li>
</ul>
<h4 id="【加载阶段】"><a href="#【加载阶段】" class="headerlink" title="【加载阶段】"></a>【加载阶段】</h4><p>tileLoadFunction 接管默认加载</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">tileLoadFunction</span><span class="hljs-params">(imageTile, src)</span></span> &#123; ... &#125;<br></code></pre></td></tr></table></figure>

<p>所以 OpenLayers 对每个瓦片会调用这个函数：</p>
<ul>
<li><code>imageTile</code>：当前瓦片对象（里面有对应的 <code>&lt;img&gt;</code>）</li>
<li><code>src</code>：刚才生成的那条 GetMap URL</li>
</ul>
<p>你在这里做了：</p>
<h5 id="5-1-fetch-请求（带-Token-Header）"><a href="#5-1-fetch-请求（带-Token-Header）" class="headerlink" title="5.1 fetch 请求（带 Token Header）"></a>5.1 fetch 请求（带 Token Header）</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">fetch(<span class="hljs-attribute">src</span>, &#123; headers: &#123; Token: token &#125; &#125;)<br></code></pre></td></tr></table></figure>

<p>这是你不能用 XYZ 的关键原因之一：<code>&lt;img src&gt;</code> 不能带自定义 Header，而 fetch 可以。</p>
<h5 id="5-2-取回-PNG-二进制"><a href="#5-2-取回-PNG-二进制" class="headerlink" title="5.2 取回 PNG 二进制"></a>5.2 取回 PNG 二进制</h5><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">response<span class="hljs-selector-class">.blob</span>()<br></code></pre></td></tr></table></figure>

<h5 id="5-3-转换成浏览器可用的图片-URL"><a href="#5-3-转换成浏览器可用的图片-URL" class="headerlink" title="5.3 转换成浏览器可用的图片 URL"></a>5.3 转换成浏览器可用的图片 URL</h5><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">const objectUrl <span class="hljs-operator">=</span> URL.createObjectURL(blob)<br></code></pre></td></tr></table></figure>

<h5 id="5-4-把瓦片的-img-指向这个-objectUrl"><a href="#5-4-把瓦片的-img-指向这个-objectUrl" class="headerlink" title="5.4 把瓦片的 img 指向这个 objectUrl"></a>5.4 把瓦片的 img 指向这个 objectUrl</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">imageTile<span class="hljs-selector-class">.getImage</span>()<span class="hljs-selector-class">.src</span> = objectUrl<br></code></pre></td></tr></table></figure>

<p>此时浏览器开始解码 PNG，瓦片进入“可渲染”状态。</p>
<h4 id="【渲染阶段】"><a href="#【渲染阶段】" class="headerlink" title="【渲染阶段】"></a>【渲染阶段】</h4><p>当 <code>&lt;img&gt;</code> 完成加载后：</p>
<ul>
<li>OpenLayers 将该瓦片标记为 loaded</li>
<li>在下一帧 render 时，把这块瓦片贴到正确位置</li>
<li>多块瓦片拼接起来，构成你看到的完整地图</li>
</ul>
<h4 id="【服务端视角：每次瓦片请求服务端在做什么】"><a href="#【服务端视角：每次瓦片请求服务端在做什么】" class="headerlink" title="【服务端视角：每次瓦片请求服务端在做什么】"></a>【服务端视角：每次瓦片请求服务端在做什么】</h4><p>你后端收到每个 GetMap 请求后，典型逻辑是：</p>
<ol>
<li>校验 Token 权限</li>
<li>解析 Map&#x2F;QGS、LAYERS、language 等业务参数</li>
<li>根据 BBOX + WIDTH&#x2F;HEIGHT 从源数据（tif&#x2F;工程&#x2F;数据库）裁剪</li>
<li>渲染成 PNG</li>
<li>返回给前端</li>
</ol>
<p>你看到的“瓦片”，是服务端<strong>按 BBOX 实时渲染</strong>出来的，不一定是磁盘上提前存好的 <code>/z/x/y.png</code>。</p>
<h3 id="7-绘制内容"><a href="#7-绘制内容" class="headerlink" title="7. 绘制内容"></a>7. 绘制内容</h3><p>在 OpenLayers 中，<strong>矢量图层 &#x3D; 几何 + 样式 + 属性</strong>，常见可绘制内容包括：</p>
<h4 id="【几何】"><a href="#【几何】" class="headerlink" title="【几何】"></a>【几何】</h4><p>几何对象的标准分类只有三种：</p>
<ol>
<li><p><strong>点（Point）</strong></p>
<ul>
<li>表示单一空间位置</li>
<li>由一个坐标对 <code>(x, y)</code> 定义</li>
<li>可附带任意属性与样式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Point</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ol/geom/Point&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Feature</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ol/Feature&#x27;</span>;<br><br><span class="hljs-keyword">const</span> point = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Feature</span>(&#123;<br>  <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>([x, y]) <span class="hljs-comment">// 通常需是 EPSG:3857</span><br>&#125;);<br></code></pre></td></tr></table></figure>


</li>
<li><p><strong>线（LineString &#x2F; MultiLineString）</strong></p>
<ul>
<li>表示由多个点按顺序连接形成的路径</li>
<li>至少包含两个坐标点</li>
<li>常用于轨迹、线路、边界线表达</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">LineString</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ol/geom/LineString&#x27;</span>;<br><br><span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Feature</span>(&#123;<br>  <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">LineString</span>([<br>    [x1, y1],<br>    [x2, y2],<br>    [x3, y3]<br>  ])<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>分段绘制线</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Feature</span>(&#123;<br>  <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">LineString</span>([p1, p2])<br>&#125;);<br></code></pre></td></tr></table></figure>

<ul>
<li>每两个相邻点生成一段线</li>
<li>连续追加 Feature 形成完整轨迹</li>
<li>非常适合实时或回放场景</li>
</ul>
</li>
<li><p><strong>面（Polygon &#x2F; MultiPolygon）</strong></p>
<ul>
<li>表示由闭合线围成的区域</li>
<li>具备内部区域与边界</li>
<li>常用于范围、区域、缓冲区表达</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Polygon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ol/geom/Polygon&#x27;</span>;<br><br><span class="hljs-keyword">const</span> polygon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Feature</span>(&#123;<br>  <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Polygon</span>([[<br>    [x1, y1],<br>    [x2, y2],<br>    [x3, y3],<br>    [x1, y1] <span class="hljs-comment">// 闭合</span><br>  ]])<br>&#125;);<br><br></code></pre></td></tr></table></figure></li>
</ol>
<p>在 OpenLayers 中：</p>
<ul>
<li><strong>几何（Geometry）</strong> 决定“画什么”</li>
<li><strong>样式（Style）</strong> 决定“怎么画”</li>
</ul>
<p>因此：</p>
<ul>
<li>圆点、图标、文字，本质上都是 <strong>Point</strong></li>
<li>车辆、人员、设备，只是 <strong>Point + Icon 样式</strong></li>
<li>高亮、闪烁、分级配色，是 <strong>Style 的变化</strong></li>
</ul>
<h4 id="【样式】"><a href="#【样式】" class="headerlink" title="【样式】"></a>【样式】</h4><p>一个完整的矢量样式通常由以下几部分组成：</p>
<ul>
<li><code>image</code>：点要素的图形样式（圆点、图标等）</li>
<li><code>stroke</code>：线或面的边框样式</li>
<li><code>fill</code>：面或圆点的填充样式</li>
<li><code>text</code>：文字标注样式</li>
<li><code>zIndex</code>：绘制层级顺序</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs css">Style<br>├─ <span class="hljs-selector-tag">image</span>   → 仅对 Point / MultiPoint 生效<br>│   ├─ CircleStyle<br>│   │    ├─ <span class="hljs-attribute">fill</span>   → 圆点内部填充<br>│   │    └─ <span class="hljs-attribute">stroke</span> → 圆点描边<br>│   └─ <span class="hljs-attribute">Icon</span><br>│        └─ rotation / <span class="hljs-attribute">scale</span> / <span class="hljs-attribute">src</span><br>│<br>├─ <span class="hljs-attribute">stroke</span>  → 对 LineString / <span class="hljs-selector-tag">Polygon</span> 边界生效<br>│<br>├─ <span class="hljs-attribute">fill</span>    → 仅对 <span class="hljs-selector-tag">Polygon</span> 内部区域生效<br>│<br>├─ <span class="hljs-selector-tag">text</span>    → 对所有几何都可叠加（文字标注）<br>│   ├─ <span class="hljs-attribute">fill</span>   → 文字颜色<br>│   └─ <span class="hljs-attribute">stroke</span> → 文字描边<br>│<br>└─ zIndex  → 整个 Style 的绘制顺序<br><br></code></pre></td></tr></table></figure>

<h5 id="1-圆点样式（CircleStyle）"><a href="#1-圆点样式（CircleStyle）" class="headerlink" title="1. 圆点样式（CircleStyle）"></a>1. 圆点样式（CircleStyle）</h5><p>适用于：采样点、监测点、事件点、浓度点。</p>
<p><strong>常见可配置项</strong></p>
<ul>
<li><code>radius</code>：圆点半径</li>
<li><code>fill.color</code>：填充颜色</li>
<li><code>stroke.color / width</code>：描边颜色与宽度</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">CircleStyle</span>(&#123;<br>  <span class="hljs-attr">radius</span>: <span class="hljs-number">5</span>,<br>  <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#ff0000&#x27;</span> &#125;),<br>  <span class="hljs-attr">stroke</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>(&#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#ffffff&#x27;</span>,<br>    <span class="hljs-attr">width</span>: <span class="hljs-number">1</span><br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>常见用途：</p>
<ul>
<li>半径表达权重或级别</li>
<li>颜色表达数值分级</li>
<li>描边用于增强可读性或选中态</li>
</ul>
<hr>
<h5 id="2-图标样式（Icon）"><a href="#2-图标样式（Icon）" class="headerlink" title="2. 图标样式（Icon）"></a>2. 图标样式（Icon）</h5><p>适用于：车辆、设备、人员、方向性目标。</p>
<p><strong>常见可配置项</strong></p>
<ul>
<li><code>src</code>：图片地址</li>
<li><code>scale</code>：缩放比例</li>
<li><code>rotation</code>：旋转角度（弧度）</li>
<li><code>anchor</code>：锚点（决定旋转与定位中心）</li>
<li><code>opacity</code>：透明度</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Icon</span>(&#123;<br>  <span class="hljs-attr">src</span>: <span class="hljs-string">&#x27;car.png&#x27;</span>,<br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">0.6</span>,<br>  <span class="hljs-attr">rotation</span>: angle,<br>  <span class="hljs-attr">anchor</span>: [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>],<br>  <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<p>常见用途：</p>
<ul>
<li>方向随轨迹变化</li>
<li>缩放区分对象类型</li>
<li>通过 rotation 表示运动方向</li>
</ul>
<hr>
<h5 id="3-点文字标注（Text）"><a href="#3-点文字标注（Text）" class="headerlink" title="3. 点文字标注（Text）"></a>3. 点文字标注（Text）</h5><p>适用于：点位名称、数值显示、编号。</p>
<p><strong>常见可配置项</strong></p>
<ul>
<li><code>text</code>：显示内容</li>
<li><code>font</code>：字体大小与类型</li>
<li><code>fill.color</code>：文字颜色</li>
<li><code>stroke</code>：文字描边（增强对比）</li>
<li><code>offsetX / offsetY</code>：文字偏移</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(&#123;<br>  <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;监测点A&#x27;</span>,<br>  <span class="hljs-attr">font</span>: <span class="hljs-string">&#x27;12px sans-serif&#x27;</span>,<br>  <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#000&#x27;</span> &#125;),<br>  <span class="hljs-attr">stroke</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">2</span> &#125;),<br>  <span class="hljs-attr">offsetY</span>: -<span class="hljs-number">15</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-线条基础样式（Stroke）"><a href="#4-线条基础样式（Stroke）" class="headerlink" title="4. 线条基础样式（Stroke）"></a>4. 线条基础样式（Stroke）</h5><p>适用于：轨迹、路径、管线、边界线。</p>
<p><strong>常见可配置项</strong></p>
<ul>
<li><code>color</code>：线颜色</li>
<li><code>width</code>：线宽</li>
<li><code>lineDash</code>：虚线样式</li>
<li><code>lineCap</code>：线端样式</li>
<li><code>lineJoin</code>：转角样式</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>(&#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#12FF9B&#x27;</span>,<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-attr">lineDash</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">4</span>],<br>  <span class="hljs-attr">lineCap</span>: <span class="hljs-string">&#x27;round&#x27;</span>,<br>  <span class="hljs-attr">lineJoin</span>: <span class="hljs-string">&#x27;round&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<p>常见用途：</p>
<ul>
<li>实线 &#x2F; 虚线区分状态</li>
<li>线宽表示重要程度</li>
<li>颜色表示类型或告警级别</li>
</ul>
<hr>
<h5 id="6-线文字标注（沿线标注）"><a href="#6-线文字标注（沿线标注）" class="headerlink" title="6. 线文字标注（沿线标注）"></a>6. 线文字标注（沿线标注）</h5><p>适用于：道路名称、管线编号。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(&#123;<br>  <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;轨迹&#x27;</span>,<br>  <span class="hljs-attr">placement</span>: <span class="hljs-string">&#x27;line&#x27;</span>,<br>  <span class="hljs-attr">font</span>: <span class="hljs-string">&#x27;12px sans-serif&#x27;</span>,<br>  <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#000&#x27;</span> &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<h5 id="7-面填充（Fill）"><a href="#7-面填充（Fill）" class="headerlink" title="7. 面填充（Fill）"></a>7. 面填充（Fill）</h5><p>适用于：区域、范围、影响区、行政区。</p>
<p><strong>常见可配置项</strong></p>
<ul>
<li><code>color</code>：填充颜色（通常使用半透明）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;rgba(255,0,0,0.3)&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="2-面边界（Stroke）"><a href="#2-面边界（Stroke）" class="headerlink" title="2. 面边界（Stroke）"></a>2. 面边界（Stroke）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>(&#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#ff0000&#x27;</span>,<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">2</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<p>常见组合：</p>
<ul>
<li>半透明填充 + 实线边界</li>
<li>不同颜色表示不同风险等级</li>
</ul>
<hr>
<h4 id="【样式的三种使用方式】"><a href="#【样式的三种使用方式】" class="headerlink" title="【样式的三种使用方式】"></a>【样式的三种使用方式】</h4><h5 id="1-图层统一样式"><a href="#1-图层统一样式" class="headerlink" title="1. 图层统一样式"></a>1. 图层统一样式</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">VectorLayer</span>(&#123;<br>  source,<br>  <span class="hljs-attr">style</span>: fixedStyle<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>适用于：</p>
<ul>
<li>静态要素</li>
<li>样式一致的图层</li>
</ul>
<hr>
<h5 id="2-基于-Feature-的样式函数"><a href="#2-基于-Feature-的样式函数" class="headerlink" title="2. 基于 Feature 的样式函数"></a>2. 基于 Feature 的样式函数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">style</span>: <span class="hljs-function"><span class="hljs-params">feature</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Style</span>(&#123;<br>    <span class="hljs-attr">image</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircleStyle</span>(&#123;<br>      <span class="hljs-attr">radius</span>: feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;radius&#x27;</span>),<br>      <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>(&#123; <span class="hljs-attr">color</span>: feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;color&#x27;</span>) &#125;)<br>    &#125;)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>适用于：</p>
<ul>
<li>实时数据</li>
<li>数值分级渲染</li>
<li>同一图层不同样式</li>
</ul>
<hr>
<h5 id="3-交互中动态-setStyle"><a href="#3-交互中动态-setStyle" class="headerlink" title="3. 交互中动态 setStyle"></a>3. 交互中动态 setStyle</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">feature.<span class="hljs-title function_">setStyle</span>(highlightStyle);<br></code></pre></td></tr></table></figure>

<p>适用于：</p>
<ul>
<li>点击高亮</li>
<li>选中态</li>
<li>告警态切换</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/" class="category-chain-item">前端学习</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" class="print-no-link">#前端面试题</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>15.OpenLayers地图绘制</div>
      <div>http://example.com/2026/01/06/前端学习/15-二维地图绘制/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Xiang Chen</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2026年1月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/01/07/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/Vite%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80SCSS/" title="Vite如何配置全局SCSS?">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Vite如何配置全局SCSS?</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/06/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/14-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%A7%A6%E5%8F%91%E7%9A%84%E4%B8%A4%E4%B8%AA%E4%BA%8B%E4%BB%B6/" title="14.浏览器渲染触发的两个事件">
                        <span class="hidden-mobile">14.浏览器渲染触发的两个事件</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"xXfj7jVpB8fiyIpWQbXJP1Gj-gzGzoHsz","appKey":"RoFR6Po4mFIHocqHXZ42PUGO","path":"window.location.pathname","placeholder":"输入你的评论","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
